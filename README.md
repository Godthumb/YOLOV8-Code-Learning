# YOLOV8-Code-Learning
**学习YOLOv8正负样本如何分配**

## Usage
`
python LabelAssigner.py 
`</br>
运行改代码可以看到完整的输出，输出会保存在run.log中

## 具体过程
### 输入
#### 输入有两个，一个是YOLOV8 NECK的三层输出
```
inputs = [torch.randn(4, 67, 6, 6),
              torch.randn(4, 67, 4, 4),
              torch.randn(4, 67, 2, 2)
              ]  # b=4
```
- 这里假设是做三类分类任务，所以输出通道为64+3
- 一般来讲特征图大小在输入图像大小为640的情况下应该为80, 40, 20, 这里为了查看输出结果，改为6, 4, 2, 因此总输出的预测框从原始的8400变为6 * 6 + 4 * 4 + 2 * 2 = 56
- 假设batch = 4

#### 另一个输入是标注框
```
labels = torch.tensor(np.array([[0, 1.0, 0.612, 0.334, 0.666, 0.378],
                                    [0, 0.0, 0.553, 0.054, 0.426, 0.109],
                                    [1, 1.0, 0.457, 0.324, 0.747, 0.359],
                                    [2, 2.0, 0.875 , 0.484, 0.25, 0.315],
                                    [2, 1.0, 0.45, 0.36, 0.72, 0.411],
                                    [2, 0.0, 0.27, 0.064, 0.46, 0.12],
                                    [3, 2.0, 0.348, 0.521, 0.151, 0.237]]), dtype=torch.float32)
```
- 该标注框是YOLO的标准输入格式，为(n ,6)的矩阵。分别代表该图片在该batch中的索引、类别、归一化中心点x坐标、归一化中心点y坐标、归一化宽、归一化高。给出的labels来自实际任务，为人体的标注框。

### 整体目的
在了解输入后，应该明白整个正负样本分配的目的。在此之前，需要知道网络模型的预测输出大小，输出同样有两个，一个为预测分数pred_scores，shape为(b, anchor_num=56, cls_num=3); 另一个为预测坐标pred_bboxes，shape为(b, anchor_num=56, 4), 而*整个正负样本分配的目的就是将labels变化成同上述矩阵相同的大小*，即最后输出target_scores的shape为(b, anchor_num=56, cls_num=3)， target_bboxes为(b, anchor_num=56, 4)，*完成为每一个anchor给予标签的作用。*

### 整体流程概览


## Acknowledgement
感谢[https://zhuanlan.zhihu.com/p/633094573](https://zhuanlan.zhihu.com/p/633094573)，本文根据该知乎讲解进行整理
